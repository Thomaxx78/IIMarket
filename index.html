<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FriendMarket â€” PrÃ©dictions entre amis</title>

<!-- PWA + Push (requis pour iOS 16.4+) -->
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#7c3aed">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FriendMarket">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

<link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">âš¡ FriendMarket</div>
    <div class="login-sub">MarchÃ©s prÃ©dictifs virtuels entre amis</div>
    <select class="login-select" id="login-select">
      <option value="">â€” Choisir un profil existant â€”</option>
    </select>
    <div style="color:var(--muted);font-size:0.75rem;margin-bottom:10px;">ou crÃ©er un nouveau compte</div>
    <input type="text" class="login-input" id="login-name" placeholder="Entre ton prÃ©nom" maxlength="20">
    <button class="btn-primary" onclick="loginUser()">Entrer dans l'arÃ¨ne â†—</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <header>
    <div class="header-inner">
      <div class="logo" onclick="navigate('markets')">âš¡ FriendMarket</div>
      <!-- Top nav desktop uniquement -->
      <nav class="top-nav">
        <button class="nav-btn active" id="nav-markets-top" onclick="navigate('markets')">MarchÃ©s</button>
        <button class="nav-btn" id="nav-leaderboard-top" onclick="navigate('leaderboard')">Classement</button>
        <button class="nav-btn" id="nav-profile-top" onclick="navigate('profile')">Profil</button>
        <button class="nav-btn" id="nav-create-top" onclick="navigate('create')">+ CrÃ©er</button>
      </nav>
      <div class="header-right">
        <div class="wallet-badge" id="wallet-display">1000 ğŸª™</div>
        <button class="btn-sm" id="notif-btn" onclick="requestNotifPermission()" title="Activer les notifications">ğŸ””</button>
        <div class="user-badge" id="user-display">?</div>
      </div>
    </div>
  </header>

  <!-- Bottom nav mobile -->
  <nav class="bottom-nav">
    <button class="bnav-btn active" id="nav-markets" onclick="navigate('markets')">
      <span class="bnav-icon">ğŸª</span>
      <span>MarchÃ©s</span>
    </button>
    <button class="bnav-btn" id="nav-leaderboard" onclick="navigate('leaderboard')">
      <span class="bnav-icon">ğŸ†</span>
      <span>Classement</span>
    </button>
    <button class="bnav-btn bnav-create" id="nav-create" onclick="navigate('create')">
      <span class="bnav-create-inner">ï¼‹</span>
    </button>
    <button class="bnav-btn" id="nav-profile" onclick="navigate('profile')">
      <span class="bnav-icon">ğŸ‘¤</span>
      <span>Profil</span>
    </button>
  </nav>

  <!-- MARKETS -->
  <div class="page active" id="page-markets">
    <div class="hero">
      <h1>PrÃ©dis l'avenir,<br><span>gagne des coins.</span></h1>
      <p>MarchÃ©s prÃ©dictifs virtuels entre amis Â· LMSR Â· Aucun argent rÃ©el.</p>
      <div class="stats-row" id="global-stats"></div>
    </div>
    <div class="section-header">
      <span class="section-title">ğŸ”¥ MarchÃ©s actifs</span>
      <button class="btn-sm btn-accent" onclick="navigate('create')">+ CrÃ©er un marchÃ©</button>
    </div>
    <div class="markets-grid" id="markets-grid"></div>
    <div style="margin-top:32px;">
      <div class="section-header"><span class="section-title">âœ… MarchÃ©s rÃ©solus</span></div>
      <div class="markets-grid" id="resolved-grid"></div>
    </div>
  </div>

  <!-- LEADERBOARD -->
  <div class="page" id="page-leaderboard">
    <div class="section-header" style="margin-bottom:28px;">
      <span class="section-title" style="font-size:1.4rem;">ğŸ† Classement gÃ©nÃ©ral</span>
    </div>
    <div class="leaderboard" id="leaderboard-list"></div>
  </div>

  <!-- PROFILE -->
  <div class="page" id="page-profile">
    <div class="profile-header">
      <div class="avatar-big" id="profile-avatar"></div>
      <div>
        <div style="font-size:1.3rem;font-weight:800;margin-bottom:12px;" id="profile-name"></div>
        <div class="profile-stats" id="profile-stats"></div>
      </div>
    </div>
    <div style="margin-bottom:24px;">
      <button class="btn-sm" onclick="logoutUser()" style="color:var(--no);border-color:var(--no);">â†© Se dÃ©connecter</button>
    </div>
    <div class="section-header"><span class="section-title">ğŸ“‹ Mes positions actives</span></div>
    <div class="markets-grid" id="my-positions"></div>
    <div style="margin-top:24px;">
      <div class="section-header"><span class="section-title">ğŸ“œ Historique des transactions</span></div>
      <div id="my-history"></div>
    </div>
  </div>

  <!-- CREATE -->
  <div class="page" id="page-create">
    <div class="create-form">
      <div class="form-title">âœ¨ CrÃ©er un marchÃ© prÃ©dictif</div>
      <label>Question (rÃ©ponse Oui/Non) â€” tape @ pour mentionner quelqu'un</label>
      <div class="mention-wrap">
        <div
          id="question-editor"
          contenteditable="true"
          data-placeholder="Ex : Est-ce que @Lucas va finir son marathon en moins de 4h ?"
          spellcheck="true"
        ></div>
        <div class="mention-dropdown" id="mention-dropdown"></div>
      </div>

      <div id="hide-banner" style="display:none" class="hide-banner">
        <div class="hide-banner-title">ğŸ‘ï¸ Personnes mentionnÃ©es â€” masquer le marchÃ© ?</div>
        <div id="hide-toggles"></div>
      </div>

      <label>CatÃ©gorie</label>
      <select id="new-category">
        <option>Sport</option><option>Jeux</option><option>Vie perso</option>
        <option>Culture</option><option>Tech</option><option>Autre</option>
      </select>
      <label>Date de rÃ©solution</label>
      <input type="date" id="new-date">
      <label>ParamÃ¨tre de liquiditÃ© b (20â€“200) â€” plus grand = prix plus stable</label>
      <input type="number" id="new-b" value="50" min="20" max="200">
      <label>Mise maximum par joueur (coins)</label>
      <input type="number" id="new-max-bet" value="200" min="10" max="500">
      <div class="info-box">
        ğŸ’¡ <b>LMSR</b> : Le prix Ã©volue automatiquement selon les mises. b=50 â†’ perte max systÃ¨me â‰ˆ 35 coins. b=100 â†’ â‰ˆ 70 coins. Plus b est Ã©levÃ©, plus les prix sont stables mais moins sensibles.
      </div>
      <button class="btn-primary" onclick="createMarket()">CrÃ©er le marchÃ© ğŸš€</button>
    </div>
  </div>
</div>

<!-- MARKET MODAL -->
<div class="modal-overlay" id="market-modal">
  <div class="modal" id="modal-content"></div>
</div>

<!-- Scripts â€” ordre important : dÃ©pendances d'abord -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script src="js/lmsr.js"></script>
<script src="js/db.js"></script>
<script src="js/ui.js"></script>
<script src="js/push.js"></script>
<script src="js/nav.js"></script>
<script src="js/markets.js"></script>
<script src="js/leaderboard.js"></script>
<script src="js/profile.js"></script>
<script src="js/mention.js"></script>
<script src="js/modal.js"></script>
<script src="js/auth.js"></script>
<script src="js/create.js"></script>
<script src="js/app.js"></script>

</body>
</html>
